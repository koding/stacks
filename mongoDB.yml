# Here is your stack preview
# You can make advanced changes like modifying your VM,
# installing packages, and running shell commands.

provider:
  aws:
    access_key: '${var.aws_access_key}'
    secret_key: '${var.aws_secret_key}'
resource:
  aws_instance:
    mongodb_latest:
      instance_type: t2.medium
      ami: ''
      tags:
        Name: '${var.koding_user_username}-${var.koding_group_slug}'
      user_data: |-
        #User Script:
        set -e
        export DEBIAN_FRONTEND=noninteractive
        VERSION=3.4
        #setting new key and installation source
        apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv EA312927
        echo "deb http://repo.mongodb.org/apt/ubuntu trusty/mongodb-org/$VERSION multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-$VERSION.list 
        #Updating packages 
        apt-get update -y
        #Installing MongoDB 
        apt-get -y install mongodb-org --force-yes
